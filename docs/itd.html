<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 Indivitual tree dectection and segmentation | The lidR package</title>
  <meta name="description" content="A guide to the lidR package" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="7 Indivitual tree dectection and segmentation | The lidR package" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A guide to the lidR package" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Indivitual tree dectection and segmentation | The lidR package" />
  
  <meta name="twitter:description" content="A guide to the lidR package" />
  

<meta name="author" content="Jean-Romain Roussel, Tristan R.H. Goodbody, Piotr Tompalski" />


<meta name="date" content="2020-06-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chm.html"/>
<link rel="next" href="metrics.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="io.html"><a href="io.html"><i class="fa fa-check"></i><b>2</b> Reading, Plotting, Querying &amp; Validating</a><ul>
<li class="chapter" data-level="2.1" data-path="io.html"><a href="io.html#read"><i class="fa fa-check"></i><b>2.1</b> Reading LiDAR data using <code>readLAS</code></a><ul>
<li class="chapter" data-level="2.1.1" data-path="io.html"><a href="io.html#parameter-select"><i class="fa fa-check"></i><b>2.1.1</b> Parameter <code>select</code></a></li>
<li class="chapter" data-level="2.1.2" data-path="io.html"><a href="io.html#filter"><i class="fa fa-check"></i><b>2.1.2</b> Parameter <code>filter</code></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="io.html"><a href="io.html#validating-lidar-data"><i class="fa fa-check"></i><b>2.2</b> Validating lidar data</a></li>
<li class="chapter" data-level="2.3" data-path="io.html"><a href="io.html#plot"><i class="fa fa-check"></i><b>2.3</b> Plotting</a><ul>
<li class="chapter" data-level="2.3.1" data-path="io.html"><a href="io.html#basic-3d-rendering"><i class="fa fa-check"></i><b>2.3.1</b> Basic 3D rendering</a></li>
<li class="chapter" data-level="2.3.2" data-path="io.html"><a href="io.html#overlays"><i class="fa fa-check"></i><b>2.3.2</b> Overlays</a></li>
<li class="chapter" data-level="2.3.3" data-path="io.html"><a href="io.html#advanced-3d-rendering"><i class="fa fa-check"></i><b>2.3.3</b> Advanced 3D rendering</a></li>
<li class="chapter" data-level="2.3.4" data-path="io.html"><a href="io.html#crossection"><i class="fa fa-check"></i><b>2.3.4</b> Cross sections 2D rendering</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="gnd.html"><a href="gnd.html"><i class="fa fa-check"></i><b>3</b> Ground classification</a><ul>
<li class="chapter" data-level="3.1" data-path="gnd.html"><a href="gnd.html#progressive-morphological-filter"><i class="fa fa-check"></i><b>3.1</b> Progressive Morphological Filter</a></li>
<li class="chapter" data-level="3.2" data-path="gnd.html"><a href="gnd.html#cloth-simulation-function"><i class="fa fa-check"></i><b>3.2</b> Cloth Simulation Function</a></li>
<li class="chapter" data-level="3.3" data-path="gnd.html"><a href="gnd.html#buffer"><i class="fa fa-check"></i><b>3.3</b> Edge artifacts</a></li>
<li class="chapter" data-level="3.4" data-path="gnd.html"><a href="gnd.html#how-to-choose-a-method-and-its-parameters"><i class="fa fa-check"></i><b>3.4</b> How to choose a method and its parameters?</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dtm.html"><a href="dtm.html"><i class="fa fa-check"></i><b>4</b> Digital terrain model</a><ul>
<li class="chapter" data-level="4.1" data-path="dtm.html"><a href="dtm.html#triangular-irregular-network"><i class="fa fa-check"></i><b>4.1</b> Triangular irregular network</a></li>
<li class="chapter" data-level="4.2" data-path="dtm.html"><a href="dtm.html#invert-distance-weighting-idw"><i class="fa fa-check"></i><b>4.2</b> Invert distance weighting (IDW)</a></li>
<li class="chapter" data-level="4.3" data-path="dtm.html"><a href="dtm.html#kriging"><i class="fa fa-check"></i><b>4.3</b> Kriging</a></li>
<li class="chapter" data-level="4.4" data-path="dtm.html"><a href="dtm.html#pros-and-cons"><i class="fa fa-check"></i><b>4.4</b> Pros and cons</a></li>
<li class="chapter" data-level="4.5" data-path="dtm.html"><a href="dtm.html#other-methods"><i class="fa fa-check"></i><b>4.5</b> Other methods</a></li>
<li class="chapter" data-level="4.6" data-path="dtm.html"><a href="dtm.html#render-shaded-dtm"><i class="fa fa-check"></i><b>4.6</b> Render shaded DTM</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="norm.html"><a href="norm.html"><i class="fa fa-check"></i><b>5</b> Height normalization</a><ul>
<li class="chapter" data-level="5.1" data-path="norm.html"><a href="norm.html#dtm-normalization"><i class="fa fa-check"></i><b>5.1</b> DTM normalization</a></li>
<li class="chapter" data-level="5.2" data-path="norm.html"><a href="norm.html#point-cloud-normalization"><i class="fa fa-check"></i><b>5.2</b> Point cloud normalization</a></li>
<li class="chapter" data-level="5.3" data-path="norm.html"><a href="norm.html#pros-and-cons-1"><i class="fa fa-check"></i><b>5.3</b> Pros and cons</a></li>
<li class="chapter" data-level="5.4" data-path="norm.html"><a href="norm.html#reversing-normalization"><i class="fa fa-check"></i><b>5.4</b> Reversing normalization</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chm.html"><a href="chm.html"><i class="fa fa-check"></i><b>6</b> Digital Surface Model and Canopy Height model</a><ul>
<li class="chapter" data-level="6.1" data-path="chm.html"><a href="chm.html#point-to-raster"><i class="fa fa-check"></i><b>6.1</b> Point-to-raster</a></li>
<li class="chapter" data-level="6.2" data-path="chm.html"><a href="chm.html#triangulation"><i class="fa fa-check"></i><b>6.2</b> Triangulation</a></li>
<li class="chapter" data-level="6.3" data-path="chm.html"><a href="chm.html#pit-free-algorithm"><i class="fa fa-check"></i><b>6.3</b> Pit-free algorithm</a></li>
<li class="chapter" data-level="6.4" data-path="chm.html"><a href="chm.html#post-processing-a-chm"><i class="fa fa-check"></i><b>6.4</b> Post-processing a CHM</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="itd.html"><a href="itd.html"><i class="fa fa-check"></i><b>7</b> Indivitual tree dectection and segmentation</a><ul>
<li class="chapter" data-level="7.1" data-path="itd.html"><a href="itd.html#individual-tree-detection-itd"><i class="fa fa-check"></i><b>7.1</b> Individual Tree Detection (ITD)</a><ul>
<li class="chapter" data-level="7.1.1" data-path="itd.html"><a href="itd.html#local-maximum-filter-with-fixed-windows-size"><i class="fa fa-check"></i><b>7.1.1</b> Local Maximum Filter with fixed windows size</a></li>
<li class="chapter" data-level="7.1.2" data-path="itd.html"><a href="itd.html#local-maximum-filter-with-variable-windows-size"><i class="fa fa-check"></i><b>7.1.2</b> Local Maximum Filter with variable windows size</a></li>
<li class="chapter" data-level="7.1.3" data-path="itd.html"><a href="itd.html#local-maximum-filter-on-a-chm"><i class="fa fa-check"></i><b>7.1.3</b> Local Maximum Filter on a CHM</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="itd.html"><a href="itd.html#individual-tree-segmentation-its"><i class="fa fa-check"></i><b>7.2</b> Individual Tree Segmentation (ITS)</a><ul>
<li class="chapter" data-level="7.2.1" data-path="itd.html"><a href="itd.html#segmentation-of-the-point-cloud"><i class="fa fa-check"></i><b>7.2.1</b> Segmentation of the point-cloud</a></li>
<li class="chapter" data-level="7.2.2" data-path="itd.html"><a href="itd.html#segmentation-of-the-chm"><i class="fa fa-check"></i><b>7.2.2</b> Segmentation of the CHM</a></li>
<li class="chapter" data-level="7.2.3" data-path="itd.html"><a href="itd.html#comparaison-of-tree-segmentations"><i class="fa fa-check"></i><b>7.2.3</b> Comparaison of tree segmentations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="metrics.html"><a href="metrics.html"><i class="fa fa-check"></i><b>8</b> Derived metrics</a><ul>
<li class="chapter" data-level="8.1" data-path="metrics.html"><a href="metrics.html#the-basics"><i class="fa fa-check"></i><b>8.1</b> The basics</a></li>
<li class="chapter" data-level="8.2" data-path="metrics.html"><a href="metrics.html#user-defined-metrics"><i class="fa fa-check"></i><b>8.2</b> User-defined metrics</a></li>
<li class="chapter" data-level="8.3" data-path="metrics.html"><a href="metrics.html#pre-defined-metrics"><i class="fa fa-check"></i><b>8.3</b> Pre-defined metrics</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="cba.html"><a href="cba.html"><i class="fa fa-check"></i><b>9</b> Derived metrics at the cloud level</a><ul>
<li class="chapter" data-level="9.1" data-path="cba.html"><a href="cba.html#overview"><i class="fa fa-check"></i><b>9.1</b> Overview</a></li>
<li class="chapter" data-level="9.2" data-path="cba.html"><a href="cba.html#applications"><i class="fa fa-check"></i><b>9.2</b> Applications</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="aba.html"><a href="aba.html"><i class="fa fa-check"></i><b>10</b> Derived metrics at the grid level</a><ul>
<li class="chapter" data-level="10.1" data-path="aba.html"><a href="aba.html#overview-1"><i class="fa fa-check"></i><b>10.1</b> Overview</a></li>
<li class="chapter" data-level="10.2" data-path="aba.html"><a href="aba.html#applications-1"><i class="fa fa-check"></i><b>10.2</b> Applications</a><ul>
<li class="chapter" data-level="10.2.1" data-path="aba.html"><a href="aba.html#modelling"><i class="fa fa-check"></i><b>10.2.1</b> Modelling</a></li>
<li class="chapter" data-level="10.2.2" data-path="aba.html"><a href="aba.html#density"><i class="fa fa-check"></i><b>10.2.2</b> Density</a></li>
<li class="chapter" data-level="10.2.3" data-path="aba.html"><a href="aba.html#intensity"><i class="fa fa-check"></i><b>10.2.3</b> Intensity</a></li>
<li class="chapter" data-level="10.2.4" data-path="aba.html"><a href="aba.html#other"><i class="fa fa-check"></i><b>10.2.4</b> Other</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="tba.html"><a href="tba.html"><i class="fa fa-check"></i><b>11</b> Derived metrics at the tree level</a><ul>
<li class="chapter" data-level="11.1" data-path="tba.html"><a href="tba.html#overview-2"><i class="fa fa-check"></i><b>11.1</b> Overview</a></li>
<li class="chapter" data-level="11.2" data-path="tba.html"><a href="tba.html#applications-2"><i class="fa fa-check"></i><b>11.2</b> Applications</a><ul>
<li class="chapter" data-level="11.2.1" data-path="tba.html"><a href="tba.html#selection-of-trees"><i class="fa fa-check"></i><b>11.2.1</b> Selection of trees</a></li>
<li class="chapter" data-level="11.2.2" data-path="tba.html"><a href="tba.html#tree-based-inventory"><i class="fa fa-check"></i><b>11.2.2</b> Tree based inventory</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="vba.html"><a href="vba.html"><i class="fa fa-check"></i><b>12</b> Derived metrics at the voxel level</a><ul>
<li class="chapter" data-level="12.1" data-path="vba.html"><a href="vba.html#overview-3"><i class="fa fa-check"></i><b>12.1</b> Overview</a></li>
<li class="chapter" data-level="12.2" data-path="vba.html"><a href="vba.html#applications-3"><i class="fa fa-check"></i><b>12.2</b> Applications</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="pba.html"><a href="pba.html"><i class="fa fa-check"></i><b>13</b> Derived metrics at point level</a><ul>
<li class="chapter" data-level="13.1" data-path="pba.html"><a href="pba.html#overview-4"><i class="fa fa-check"></i><b>13.1</b> Overview</a></li>
<li class="chapter" data-level="13.2" data-path="pba.html"><a href="pba.html#applications-4"><i class="fa fa-check"></i><b>13.2</b> Applications</a><ul>
<li class="chapter" data-level="13.2.1" data-path="pba.html"><a href="pba.html#roof-segmentation"><i class="fa fa-check"></i><b>13.2.1</b> Roof segmentation</a></li>
<li class="chapter" data-level="13.2.2" data-path="pba.html"><a href="pba.html#lake-and-wire-segmentation"><i class="fa fa-check"></i><b>13.2.2</b> Lake and wire segmentation</a></li>
<li class="chapter" data-level="13.2.3" data-path="pba.html"><a href="pba.html#sec:pba-mscoloring"><i class="fa fa-check"></i><b>13.2.3</b> Multi-spectral coloring</a></li>
<li class="chapter" data-level="13.2.4" data-path="pba.html"><a href="pba.html#outlier-filtering"><i class="fa fa-check"></i><b>13.2.4</b> Outlier filtering</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="engine.html"><a href="engine.html"><i class="fa fa-check"></i><b>14</b> <code>LAScatalog</code> processing engine (1/2)</a><ul>
<li class="chapter" data-level="14.1" data-path="engine.html"><a href="engine.html#rationale-for-lascatalog-functionality"><i class="fa fa-check"></i><b>14.1</b> Rationale for <code>LAScatalog</code> functionality</a></li>
<li class="chapter" data-level="14.2" data-path="engine.html"><a href="engine.html#the-lascatalog-engine"><i class="fa fa-check"></i><b>14.2</b> The <code>LAScatalog</code> engine</a></li>
<li class="chapter" data-level="14.3" data-path="engine.html"><a href="engine.html#files"><i class="fa fa-check"></i><b>14.3</b> Read a collection of files</a></li>
<li class="chapter" data-level="14.4" data-path="engine.html"><a href="engine.html#validation"><i class="fa fa-check"></i><b>14.4</b> Validation</a></li>
<li class="chapter" data-level="14.5" data-path="engine.html"><a href="engine.html#extract-regions-of-interest"><i class="fa fa-check"></i><b>14.5</b> Extract Regions of interest</a><ul>
<li class="chapter" data-level="14.5.1" data-path="engine.html"><a href="engine.html#extract-a-single-roi"><i class="fa fa-check"></i><b>14.5.1</b> Extract a single ROI</a></li>
<li class="chapter" data-level="14.5.2" data-path="engine.html"><a href="engine.html#multiple-extractions"><i class="fa fa-check"></i><b>14.5.2</b> Multiple extractions</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="engine.html"><a href="engine.html#modification-of-default-behavior"><i class="fa fa-check"></i><b>14.6</b> Modification of default behavior</a><ul>
<li class="chapter" data-level="14.6.1" data-path="engine.html"><a href="engine.html#multiple-extractions-on-disk"><i class="fa fa-check"></i><b>14.6.1</b> Multiple extractions on disk</a></li>
<li class="chapter" data-level="14.6.2" data-path="engine.html"><a href="engine.html#multiple-extraction-with-point-cloud-indexation"><i class="fa fa-check"></i><b>14.6.2</b> Multiple extraction with point cloud indexation</a></li>
</ul></li>
<li class="chapter" data-level="14.7" data-path="engine.html"><a href="engine.html#summary"><i class="fa fa-check"></i><b>14.7</b> Summary</a></li>
<li class="chapter" data-level="14.8" data-path="engine.html"><a href="engine.html#ground-classification"><i class="fa fa-check"></i><b>14.8</b> Ground classification</a><ul>
<li class="chapter" data-level="14.8.1" data-path="engine.html"><a href="engine.html#chunk-processing"><i class="fa fa-check"></i><b>14.8.1</b> Chunk processing</a></li>
<li class="chapter" data-level="14.8.2" data-path="engine.html"><a href="engine.html#modifying-buffers"><i class="fa fa-check"></i><b>14.8.2</b> Modifying buffers</a></li>
<li class="chapter" data-level="14.8.3" data-path="engine.html"><a href="engine.html#modify-the-chunk-size"><i class="fa fa-check"></i><b>14.8.3</b> Modify the chunk size</a></li>
<li class="chapter" data-level="14.8.4" data-path="engine.html"><a href="engine.html#parallel-processing"><i class="fa fa-check"></i><b>14.8.4</b> Parallel processing</a></li>
</ul></li>
<li class="chapter" data-level="14.9" data-path="engine.html"><a href="engine.html#summary-1"><i class="fa fa-check"></i><b>14.9</b> Summary</a></li>
<li class="chapter" data-level="14.10" data-path="engine.html"><a href="engine.html#digital-terrain-model"><i class="fa fa-check"></i><b>14.10</b> Digital Terrain Model</a><ul>
<li class="chapter" data-level="14.10.1" data-path="engine.html"><a href="engine.html#in-memory-dtm"><i class="fa fa-check"></i><b>14.10.1</b> In memory DTM</a></li>
<li class="chapter" data-level="14.10.2" data-path="engine.html"><a href="engine.html#on-disk-dtm"><i class="fa fa-check"></i><b>14.10.2</b> On disk DTM</a></li>
</ul></li>
<li class="chapter" data-level="14.11" data-path="engine.html"><a href="engine.html#storage-summary"><i class="fa fa-check"></i><b>14.11</b> Storage Summary</a></li>
<li class="chapter" data-level="14.12" data-path="engine.html"><a href="engine.html#height-normalization"><i class="fa fa-check"></i><b>14.12</b> Height normalization</a></li>
<li class="chapter" data-level="14.13" data-path="engine.html"><a href="engine.html#area-based-approach"><i class="fa fa-check"></i><b>14.13</b> Area Based Approach</a></li>
<li class="chapter" data-level="14.14" data-path="engine.html"><a href="engine.html#height-aba-summary"><i class="fa fa-check"></i><b>14.14</b> Height &amp; ABA Summary</a></li>
<li class="chapter" data-level="14.15" data-path="engine.html"><a href="engine.html#individual-tree-detection"><i class="fa fa-check"></i><b>14.15</b> Individual Tree Detection</a><ul>
<li class="chapter" data-level="14.15.1" data-path="engine.html"><a href="engine.html#itd-summary"><i class="fa fa-check"></i><b>14.15.1</b> ITD Summary</a></li>
</ul></li>
<li class="chapter" data-level="14.16" data-path="engine.html"><a href="engine.html#individual-tree-segmentation"><i class="fa fa-check"></i><b>14.16</b> Individual Tree Segmentation</a></li>
<li class="chapter" data-level="14.17" data-path="engine.html"><a href="engine.html#retile-a-catalog"><i class="fa fa-check"></i><b>14.17</b> Retile a catalog</a><ul>
<li class="chapter" data-level="14.17.1" data-path="engine.html"><a href="engine.html#retile-a-catalog-into-smaller-files"><i class="fa fa-check"></i><b>14.17.1</b> Retile a catalog into smaller files</a></li>
<li class="chapter" data-level="14.17.2" data-path="engine.html"><a href="engine.html#add-a-buffer-around-each-file"><i class="fa fa-check"></i><b>14.17.2</b> Add a buffer around each file</a></li>
<li class="chapter" data-level="14.17.3" data-path="engine.html"><a href="engine.html#create-a-new-collection-with-only-first-returns"><i class="fa fa-check"></i><b>14.17.3</b> Create a new collection with only first returns</a></li>
<li class="chapter" data-level="14.17.4" data-path="engine.html"><a href="engine.html#create-a-new-collection-of-small-and-buffered-ground-returns-in-parallel"><i class="fa fa-check"></i><b>14.17.4</b> Create a new collection of small and buffered ground returns in parallel</a></li>
</ul></li>
<li class="chapter" data-level="14.18" data-path="engine.html"><a href="engine.html#the-case-of-ground-inventories"><i class="fa fa-check"></i><b>14.18</b> The case of ground inventories</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="engine2.html"><a href="engine2.html"><i class="fa fa-check"></i><b>15</b> LAScatalog processing engine (2/2)</a><ul>
<li class="chapter" data-level="15.1" data-path="engine2.html"><a href="engine2.html#catalog_apply"><i class="fa fa-check"></i><b>15.1</b> <code>catalog_apply()</code></a></li>
<li class="chapter" data-level="15.2" data-path="engine2.html"><a href="engine2.html#create-user-defined-function"><i class="fa fa-check"></i><b>15.2</b> Create user-defined function</a></li>
<li class="chapter" data-level="15.3" data-path="engine2.html"><a href="engine2.html#create-an-intermediate-function-for-catalog_apply"><i class="fa fa-check"></i><b>15.3</b> Create an intermediate function for <code>catalog_apply()</code></a></li>
<li class="chapter" data-level="15.4" data-path="engine2.html"><a href="engine2.html#make-a-user-friendly-function-for-third-party-users"><i class="fa fa-check"></i><b>15.4</b> Make a user-friendly function for third party users</a></li>
<li class="chapter" data-level="15.5" data-path="engine2.html"><a href="engine2.html#make-a-safe-function-for-third-party-users"><i class="fa fa-check"></i><b>15.5</b> Make a safe function for third party users</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="aba.html"><a href="aba.html#modelling"><i class="fa fa-check"></i><b>16</b> The Area-Based Approach (ABA) to forest modelling</a><ul>
<li class="chapter" data-level="16.1" data-path="modelling.html"><a href="modelling.html"><i class="fa fa-check"></i><b>16.1</b> Read in data</a></li>
<li class="chapter" data-level="16.2" data-path="modelling.html"><a href="modelling.html#aba-processing"><i class="fa fa-check"></i><b>16.2</b> ABA Processing</a><ul>
<li class="chapter" data-level="16.2.1" data-path="modelling.html"><a href="modelling.html#step-1---clip-als-ground-inventory"><i class="fa fa-check"></i><b>16.2.1</b> Step 1 - Clip ALS ground inventory</a></li>
<li class="chapter" data-level="16.2.2" data-path="modelling.html"><a href="modelling.html#step-2---calculate-plot-metrics"><i class="fa fa-check"></i><b>16.2.2</b> Step 2 - Calculate plot metrics</a></li>
<li class="chapter" data-level="16.2.3" data-path="modelling.html"><a href="modelling.html#step-3---modeling"><i class="fa fa-check"></i><b>16.2.3</b> Step 3 - Modeling</a></li>
<li class="chapter" data-level="16.2.4" data-path="modelling.html"><a href="modelling.html#step-4---wall-to-wall-modelling"><i class="fa fa-check"></i><b>16.2.4</b> Step 4 - Wall to wall modelling</a></li>
<li class="chapter" data-level="16.2.5" data-path="modelling.html"><a href="modelling.html#step-5---calculate-wall-to-wall-predictions"><i class="fa fa-check"></i><b>16.2.5</b> Step 5 - Calculate wall-to-wall predictions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="outbox.html"><a href="outbox.html"><i class="fa fa-check"></i><b>17</b> Thinking outside the box</a><ul>
<li class="chapter" data-level="17.1" data-path="outbox.html"><a href="outbox.html#new-complex-metrics-in-aba"><i class="fa fa-check"></i><b>17.1</b> New complex metrics in ABA</a><ul>
<li class="chapter" data-level="17.1.1" data-path="outbox.html"><a href="outbox.html#outboxdistancereturn"><i class="fa fa-check"></i><b>17.1.1</b> Distance between returns</a></li>
<li class="chapter" data-level="17.1.2" data-path="outbox.html"><a href="outbox.html#outboxrumple"><i class="fa fa-check"></i><b>17.1.2</b> Rumple index</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="outbox.html"><a href="outbox.html#multi-spectral-coloring"><i class="fa fa-check"></i><b>17.2</b> Multi-spectral coloring</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="plugins.html"><a href="plugins.html"><i class="fa fa-check"></i><b>18</b> <code>lidR</code> plugin system</a><ul>
<li class="chapter" data-level="18.1" data-path="plugins.html"><a href="plugins.html#understanding-lidr-algorithms"><i class="fa fa-check"></i><b>18.1</b> Understanding lidR algorithms</a></li>
<li class="chapter" data-level="18.2" data-path="plugins.html"><a href="plugins.html#creation-of-the-mba-algorithm"><i class="fa fa-check"></i><b>18.2</b> Creation of the <code>mba</code> algorithm</a></li>
<li class="chapter" data-level="18.3" data-path="plugins.html"><a href="plugins.html#what-about-other-algorithms"><i class="fa fa-check"></i><b>18.3</b> What about other algorithms?</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The <code>lidR</code> package</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="itd" class="section level1">
<h1><span class="header-section-number">7</span> Indivitual tree dectection and segmentation</h1>
<p><strong>Individual tree detection (ITD)</strong> is the process of spatially locating trees and extracting height information. <strong>Individual tree segmentation (ITS)</strong> is the process of individually delineating detected trees. In <code>lidR</code>, detecting and segmenting functions are decoupled to maximize flexibility. Tree tops are first detected using the <code>find_trees()</code> function, followed crown delineation using <code>segment_trees()</code>. In the following chapter we will use the <code>MixedConifer.laz</code> data set, which is included internally within <code>lidR</code> to demonstrate both ITD and ITS. We will also generate a CHM (see section <a href="chm.html#chm">6</a>) to help visualize the results.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1">LASfile &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;MixedConifer.laz&quot;</span>, <span class="dt">package=</span><span class="st">&quot;lidR&quot;</span>)</a>
<a class="sourceLine" id="cb64-2" data-line-number="2">las &lt;-<span class="st"> </span><span class="kw">readLAS</span>(LASfile, <span class="dt">select =</span> <span class="st">&quot;xyzr&quot;</span>, <span class="dt">filter =</span> <span class="st">&quot;-drop_z_below 0&quot;</span>)</a>
<a class="sourceLine" id="cb64-3" data-line-number="3">chm &lt;-<span class="st"> </span><span class="kw">grid_canopy</span>(las, <span class="fl">0.5</span>, <span class="kw">pitfree</span>(<span class="dt">subcircle =</span> <span class="fl">0.2</span>))</a>
<a class="sourceLine" id="cb64-4" data-line-number="4"><span class="kw">plot</span>(las, <span class="dt">bg =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">size =</span> <span class="dv">4</span>)</a></code></pre></div>
<p><img src="lidR-book_files/figure-html/unnamed-chunk-76-1.png" width="480" style="display: block; margin: auto;" /></p>
<div id="individual-tree-detection-itd" class="section level2">
<h2><span class="header-section-number">7.1</span> Individual Tree Detection (ITD)</h2>
<p>Tree tops can be detected by applying a Local Maximum Filter (LMF) on the loaded data set. The LMF in <code>lidR</code> is point cloud-based, meaning that it finds the tree tops from the point cloud without any raster like a CHM. The processing, however is actually very similar. For a given point, the algorithm analyzes neigbourhood points, checking if the processed point is the highest. This algorithm can be applied with the <code>lmf()</code> function.</p>
<div id="local-maximum-filter-with-fixed-windows-size" class="section level3">
<h3><span class="header-section-number">7.1.1</span> Local Maximum Filter with fixed windows size</h3>
<p>The LMF can be applied with a constant size windows. Here with a windows size of <code>ws = 5</code> meters meaning that for a given point the algorithm looks to the neigbourhood points within a 2.4 radius circle to figure out if the point is the local highest. While the algorithm does not need any CHM to work we chose to display the results on top of a CHM for better visualization.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" data-line-number="1">ttops &lt;-<span class="st"> </span><span class="kw">find_trees</span>(las, <span class="kw">lmf</span>(<span class="dt">ws =</span> <span class="dv">5</span>))</a>
<a class="sourceLine" id="cb65-2" data-line-number="2"></a>
<a class="sourceLine" id="cb65-3" data-line-number="3"><span class="kw">plot</span>(chm, <span class="dt">col =</span> <span class="kw">height.colors</span>(<span class="dv">50</span>))</a>
<a class="sourceLine" id="cb65-4" data-line-number="4"><span class="kw">plot</span>(ttops, <span class="dt">add =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="lidR-book_files/figure-html/unnamed-chunk-77-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Tree detection results can also be visualized in 3D!</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">plot</span>(las, <span class="dt">bg =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">size =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb66-2" data-line-number="2"><span class="kw">add_treetops3d</span>(x, ttops)</a></code></pre></div>
<p><img src="lidR-book_files/figure-html/unnamed-chunk-78-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>The number of detected trees is correlated to the <code>ws</code> argument. Small windows sizes usually gives more trees, while large windows size generally miss smaller trees that are <em>“hidden”</em> by big trees that contain the highest points in the neighborhood. This can be seen in the figure below where only the dominant trees are found with a large windows size and too many trees are found with a small windows size.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" data-line-number="1">ttops_3x3 &lt;-<span class="st"> </span><span class="kw">find_trees</span>(las, <span class="kw">lmf</span>(<span class="dt">ws =</span> <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb67-2" data-line-number="2">ttops_11x11 &lt;-<span class="st"> </span><span class="kw">find_trees</span>(las, <span class="kw">lmf</span>(<span class="dt">ws =</span> <span class="dv">11</span>))</a>
<a class="sourceLine" id="cb67-3" data-line-number="3"></a>
<a class="sourceLine" id="cb67-4" data-line-number="4"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb67-5" data-line-number="5"><span class="kw">plot</span>(chm, <span class="dt">col =</span> <span class="kw">height.colors</span>(<span class="dv">50</span>))</a>
<a class="sourceLine" id="cb67-6" data-line-number="6"><span class="kw">plot</span>(ttops_3x3, <span class="dt">add =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb67-7" data-line-number="7"><span class="kw">plot</span>(chm, <span class="dt">col =</span> <span class="kw">height.colors</span>(<span class="dv">50</span>))</a>
<a class="sourceLine" id="cb67-8" data-line-number="8"><span class="kw">plot</span>(ttops_11x11, <span class="dt">add =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="lidR-book_files/figure-html/unnamed-chunk-79-1.png" width="960" style="display: block; margin: auto;" /></p>
</div>
<div id="local-maximum-filter-with-variable-windows-size" class="section level3">
<h3><span class="header-section-number">7.1.2</span> Local Maximum Filter with variable windows size</h3>
<p>The examples above demonstrate the <code>lmf()</code> function with a constant window size. A large windows is suitable for large scattered trees while a small windows size if preferable for small and close trees. In reality trees of variable sizes may be present in a single scene leading to sub-optimal outputs. To overcome this issue, a windows size that adapts to the height of pixels or height of the points in our case becomes necessary.</p>
<p>For example, a point at 30 m (a big tree) will be tested with a large neighbourhood, while a point at 10 m (a smaller tree) will be tested with a smaller window. The window size can therefore be defined as a function of height. Tall trees have comparatively larger crowns, needing larger window sizes to accurately detect their treetops. Variable window sizes are especially suitable for stands of more complex structures, or when tree detection is performed on larger areas, covering heterogeneous stands.</p>
<p>in <code>lidR</code> a user can design a function that computes a windows size as a function of point (or pixel) height. When designing a function to define the window size based on point heights we need to determine what the minimum and maximum window size should be related to the minimum and maximum tree heights. In general, the minimum window size should not be smaller than 3 meters. Below we show an example where the windows size is related to the point height with an affine relationship. When a point is at 0 the windows size is 3 meters. At 10 m it is 4 m and so on.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="cf">function</span>(x) {x <span class="op">*</span><span class="st"> </span><span class="fl">0.1</span> <span class="op">+</span><span class="st"> </span><span class="dv">3</span>}</a>
<a class="sourceLine" id="cb68-2" data-line-number="2"></a>
<a class="sourceLine" id="cb68-3" data-line-number="3">heights &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">30</span>,<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb68-4" data-line-number="4">ws &lt;-<span class="st"> </span><span class="kw">f</span>(heights)</a>
<a class="sourceLine" id="cb68-5" data-line-number="5"><span class="kw">plot</span>(heights, ws, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">6</span>))</a></code></pre></div>
<p><img src="lidR-book_files/figure-html/unnamed-chunk-80-1.png" width="326.4" style="display: block; margin: auto;" /></p>
<p>When applied within <code>lmf()</code>, the function yields the following result:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" data-line-number="1">ttops &lt;-<span class="st"> </span><span class="kw">find_trees</span>(las, <span class="kw">lmf</span>(f))</a>
<a class="sourceLine" id="cb69-2" data-line-number="2"></a>
<a class="sourceLine" id="cb69-3" data-line-number="3"><span class="kw">plot</span>(chm, <span class="dt">col =</span> <span class="kw">height.colors</span>(<span class="dv">50</span>))</a>
<a class="sourceLine" id="cb69-4" data-line-number="4"><span class="kw">plot</span>(ttops, <span class="dt">add =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="lidR-book_files/figure-html/unnamed-chunk-81-1.png" width="499.2" style="display: block; margin: auto;" /></p>
<p>There is no intrinsic limitation to the user-defined function. One does however need to pay attention to special cases. For example, if a point is below 0 m the function above will compute a negative windows size and the detection will fail. Similarly, if an outlier is encountered a massive window may be computed and lead to suspicious results. We therfore recommend using a more robust function with some built in thresholds.</p>
<p>In the next example any points below 2 m will equate to a window size of 3 m, while points above 20 meters equate to a window size of 5 m. Anything between 2 and 20 meter will have a non-linear relationship, because, why not?</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb70-2" data-line-number="2">  y &lt;-<span class="st"> </span><span class="fl">2.6</span> <span class="op">*</span><span class="st"> </span>(<span class="op">-</span>(<span class="kw">exp</span>(<span class="op">-</span><span class="fl">0.08</span><span class="op">*</span>(x<span class="dv">-2</span>)) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb70-3" data-line-number="3">  y[x <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb70-4" data-line-number="4">  y[x <span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span>] &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb70-5" data-line-number="5">  <span class="kw">return</span>(y)</a>
<a class="sourceLine" id="cb70-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb70-7" data-line-number="7"></a>
<a class="sourceLine" id="cb70-8" data-line-number="8">heights &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">5</span>,<span class="dv">30</span>,<span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb70-9" data-line-number="9">ws &lt;-<span class="st"> </span><span class="kw">f</span>(heights)</a>
<a class="sourceLine" id="cb70-10" data-line-number="10"><span class="kw">plot</span>(heights, ws, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>,  <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">5</span>))</a></code></pre></div>
<p><img src="lidR-book_files/figure-html/unnamed-chunk-82-1.png" width="326.4" style="display: block; margin: auto;" /></p>
</div>
<div id="local-maximum-filter-on-a-chm" class="section level3">
<h3><span class="header-section-number">7.1.3</span> Local Maximum Filter on a CHM</h3>
<p>So far tree detection was performed on a point cloud. A CHM can however also be used to find trees instead of the point cloud. This is also a perfectly valid way to process ALS data. Performing the detection on a CHM is faster because there are less data to process, but it is also more complex because the output depends on how the CHM has been built. The spatial resolution (i.e. pixel size), the algorithm used (see section <a href="chm.html#chm">6</a>), and any additional post-processing steps will influence tree detection results.</p>
<p>In the examples below we run tree detection on CHM generated with different algorithms (<code>p2r</code>, <code>pitfree</code>), different resolutions (0.5 and 1 m), and different post-processing smoothing steps with a median filter applied. First the different CHMs are generated:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" data-line-number="1"><span class="co"># Point-to-raster 2 resolutions</span></a>
<a class="sourceLine" id="cb71-2" data-line-number="2">chm_p2r_<span class="dv">05</span> &lt;-<span class="st"> </span><span class="kw">grid_canopy</span>(las, <span class="fl">0.5</span>, <span class="kw">p2r</span>(<span class="dt">subcircle =</span> <span class="fl">0.2</span>))</a>
<a class="sourceLine" id="cb71-3" data-line-number="3">chm_p2r_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">grid_canopy</span>(las, <span class="dv">1</span>, <span class="kw">p2r</span>(<span class="dt">subcircle =</span> <span class="fl">0.2</span>))</a>
<a class="sourceLine" id="cb71-4" data-line-number="4"></a>
<a class="sourceLine" id="cb71-5" data-line-number="5"><span class="co"># Pitfree with and without subcircle tweak</span></a>
<a class="sourceLine" id="cb71-6" data-line-number="6">chm_pitfree_<span class="dv">05</span>_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">grid_canopy</span>(las, <span class="fl">0.5</span>, <span class="kw">pitfree</span>())</a>
<a class="sourceLine" id="cb71-7" data-line-number="7">chm_pitfree_<span class="dv">05</span>_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">grid_canopy</span>(las, <span class="fl">0.5</span>, <span class="kw">pitfree</span>(<span class="dt">subcircle =</span> <span class="fl">0.2</span>))</a>
<a class="sourceLine" id="cb71-8" data-line-number="8"></a>
<a class="sourceLine" id="cb71-9" data-line-number="9"><span class="co"># Post-processing median filter</span></a>
<a class="sourceLine" id="cb71-10" data-line-number="10">kernel &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb71-11" data-line-number="11">chm_p2r_<span class="dv">05</span>_smoothed &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw">focal</span>(chm_p2r_<span class="dv">05</span>, <span class="dt">w =</span> kernel, <span class="dt">fun =</span> median, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb71-12" data-line-number="12">chm_p2r_<span class="dv">1</span>_smoothed &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw">focal</span>(chm_p2r_<span class="dv">1</span>, <span class="dt">w =</span> kernel, <span class="dt">fun =</span> median, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Then the same tree detection routine with a constant windows size of 5 m is applied to each CHM:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1">ttops_chm_p2r_<span class="dv">05</span> &lt;-<span class="st"> </span><span class="kw">find_trees</span>(chm_p2r_<span class="dv">05</span>, <span class="kw">lmf</span>(<span class="dv">5</span>))</a>
<a class="sourceLine" id="cb72-2" data-line-number="2">ttops_chm_p2r_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">find_trees</span>(chm_p2r_<span class="dv">1</span>, <span class="kw">lmf</span>(<span class="dv">5</span>))</a>
<a class="sourceLine" id="cb72-3" data-line-number="3">ttops_chm_pitfree_<span class="dv">05</span>_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">find_trees</span>(chm_pitfree_<span class="dv">05</span>_<span class="dv">1</span>, <span class="kw">lmf</span>(<span class="dv">5</span>))</a>
<a class="sourceLine" id="cb72-4" data-line-number="4">ttops_chm_pitfree_<span class="dv">05</span>_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">find_trees</span>(chm_pitfree_<span class="dv">05</span>_<span class="dv">2</span>, <span class="kw">lmf</span>(<span class="dv">5</span>))</a>
<a class="sourceLine" id="cb72-5" data-line-number="5">ttops_chm_p2r_<span class="dv">05</span>_smoothed &lt;-<span class="st"> </span><span class="kw">find_trees</span>(chm_p2r_<span class="dv">05</span>_smoothed, <span class="kw">lmf</span>(<span class="dv">5</span>))</a>
<a class="sourceLine" id="cb72-6" data-line-number="6">ttops_chm_p2r_<span class="dv">1</span>_smoothed &lt;-<span class="st"> </span><span class="kw">find_trees</span>(chm_p2r_<span class="dv">1</span>_smoothed, <span class="kw">lmf</span>(<span class="dv">5</span>))</a></code></pre></div>
<p>Finally the detection results are visualized to see the various output found as a function of the CHM building choices:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb73-2" data-line-number="2">col =<span class="st"> </span><span class="kw">height.colors</span>(<span class="dv">50</span>)</a>
<a class="sourceLine" id="cb73-3" data-line-number="3"><span class="kw">plot</span>(chm_p2r_<span class="dv">05</span>, <span class="dt">main =</span> <span class="st">&quot;CHM P2R 0.5&quot;</span>, <span class="dt">col =</span> col); <span class="kw">plot</span>(ttops_chm_p2r_<span class="dv">05</span>, <span class="dt">add =</span> T)</a>
<a class="sourceLine" id="cb73-4" data-line-number="4"><span class="kw">plot</span>(chm_p2r_<span class="dv">1</span>, <span class="dt">main =</span> <span class="st">&quot;CHM P2R 1&quot;</span>, <span class="dt">col =</span> col); <span class="kw">plot</span>(ttops_chm_p2r_<span class="dv">1</span>, <span class="dt">add =</span> T)</a>
<a class="sourceLine" id="cb73-5" data-line-number="5"><span class="kw">plot</span>(chm_p2r_<span class="dv">05</span>_smoothed, <span class="dt">main =</span> <span class="st">&quot;CHM P2R 0.5 smoothed&quot;</span>, <span class="dt">col =</span> col); <span class="kw">plot</span>(ttops_chm_p2r_<span class="dv">05</span>_smoothed, <span class="dt">add =</span> T)</a>
<a class="sourceLine" id="cb73-6" data-line-number="6"><span class="kw">plot</span>(chm_p2r_<span class="dv">1</span>_smoothed, <span class="dt">main =</span> <span class="st">&quot;CHM P2R 1 smoothed&quot;</span>, <span class="dt">col =</span> col); <span class="kw">plot</span>(ttops_chm_p2r_<span class="dv">1</span>_smoothed, <span class="dt">add =</span> T)</a>
<a class="sourceLine" id="cb73-7" data-line-number="7"><span class="kw">plot</span>(chm_pitfree_<span class="dv">05</span>_<span class="dv">1</span>, <span class="dt">main =</span> <span class="st">&quot;CHM PITFREE 1&quot;</span>, <span class="dt">col =</span> col); <span class="kw">plot</span>(ttops_chm_pitfree_<span class="dv">05</span>_<span class="dv">1</span>, <span class="dt">add =</span> T)</a>
<a class="sourceLine" id="cb73-8" data-line-number="8"><span class="kw">plot</span>(chm_pitfree_<span class="dv">05</span>_<span class="dv">2</span>, <span class="dt">main =</span> <span class="st">&quot;CHM PITFREE 2&quot;</span>, <span class="dt">col =</span> col); <span class="kw">plot</span>(ttops_chm_pitfree_<span class="dv">05</span>_<span class="dv">2</span>, <span class="dt">add =</span> T)</a></code></pre></div>
<p><img src="lidR-book_files/figure-html/unnamed-chunk-85-1.png" width="960" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="individual-tree-segmentation-its" class="section level2">
<h2><span class="header-section-number">7.2</span> Individual Tree Segmentation (ITS)</h2>
<p>While individual tree detection provides very useful information about tree density and size, one may want to go further to segment and extract each tree individually. Several algorithms are available in <code>lidR</code> and can be divided in two families.</p>
<ol style="list-style-type: decimal">
<li>Point cloud-based that perform without a CHM.</li>
<li>Raster-based that using a CHM.</li>
</ol>
<p>Each family can be divided into two sub families</p>
<ol style="list-style-type: decimal">
<li>Algorithms that work in two steps - Individual tree detection followed by segmentation.</li>
<li>Algorithms that are all-in-one.</li>
</ol>
<p>In this section we won’t go through all of these possibilities, but its important to recognize that all algorithms are not well suited to every context. In the examples below we used the <code>dalponte2016()</code> algorithm, becasue we found it to perform best using the example data.</p>
<div id="segmentation-of-the-point-cloud" class="section level3">
<h3><span class="header-section-number">7.2.1</span> Segmentation of the point-cloud</h3>
<p>Even when the algorithm is raster-based (which is the case of <code>dalponte2016()</code>), <code>lidR</code> segments the point cloud and assigns an ID to each point by inserting a new attribute named <code>treeID</code> in the <code>LAS</code> object. This means that every point is associated with a particular tree. This is because <code>lidR</code> is point cloud oriented and we want to provide an immediate way to be able to access a segmented point cloud not the segmented raster.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1">algo &lt;-<span class="st"> </span><span class="kw">dalponte2016</span>(chm_p2r_<span class="dv">05</span>_smoothed, ttops_chm_p2r_<span class="dv">05</span>_smoothed)</a>
<a class="sourceLine" id="cb74-2" data-line-number="2">las &lt;-<span class="st"> </span><span class="kw">segment_trees</span>(las, algo) <span class="co"># segment point cloud</span></a>
<a class="sourceLine" id="cb74-3" data-line-number="3"><span class="kw">plot</span>(las, <span class="dt">bg =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">color =</span> <span class="st">&quot;treeID&quot;</span>) <span class="co"># visualize trees</span></a></code></pre></div>
<p><img src="lidR-book_files/figure-html/unnamed-chunk-86-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>We assign an ID to each point because it enables interesting analyses at the point-cloud level. This could involve extracting every tree to derive measurements. In the following we extracted and displayed the tree number 110.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" data-line-number="1">tree110 =<span class="st"> </span><span class="kw">filter_poi</span>(las, treeID <span class="op">==</span><span class="st"> </span><span class="dv">110</span>)</a>
<a class="sourceLine" id="cb75-2" data-line-number="2"><span class="kw">plot</span>(tree110, <span class="dt">size =</span> <span class="dv">8</span>, <span class="dt">bg =</span> <span class="st">&quot;white&quot;</span>)</a></code></pre></div>
<p><img src="lidR-book_files/figure-html/unnamed-chunk-87-1.png" width="288" style="display: block; margin: auto;" /></p>
<p><code>lidR</code> provides functions that can be used following <code>segment_trees()</code>, like delineation of crown shapes using <code>delineate_crowns()</code>. This function computes the hulls (either convex or concave) of each tree and returns a <code>SpatialPolygonsDataFrame</code>:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" data-line-number="1">crowns &lt;-<span class="st"> </span><span class="kw">delineate_crowns</span>(las)</a>
<a class="sourceLine" id="cb76-2" data-line-number="2"><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>))</a>
<a class="sourceLine" id="cb76-3" data-line-number="3"><span class="kw">plot</span>(crowns)</a></code></pre></div>
<p><img src="lidR-book_files/figure-html/unnamed-chunk-88-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>It’s also possible to compute metrics for each tree. We go further into this functionality chapter <a href="tba.html#tba">11</a>, but here is a brief example where crowns are colored by their area.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" data-line-number="1">crowns &lt;-<span class="st"> </span><span class="kw">delineate_crowns</span>(las, <span class="dt">func =</span> .stdtreemetrics)</a>
<a class="sourceLine" id="cb77-2" data-line-number="2"><span class="kw">spplot</span>(crowns, <span class="st">&quot;convhull_area&quot;</span>)</a></code></pre></div>
<p><img src="lidR-book_files/figure-html/unnamed-chunk-89-1.png" width="384" style="display: block; margin: auto;" /></p>
</div>
<div id="segmentation-of-the-chm" class="section level3">
<h3><span class="header-section-number">7.2.2</span> Segmentation of the CHM</h3>
<p>While point cloud segmentation is standard in <code>lidR</code>, users may only have access to a CHM. There are many reasons for only using a CHM, and this is why raster-based methods can be run standalone outside <code>segment_trees()</code>. Whether using the point cloud or a raster, segmentation results will be exactly the same. The difference will be the data format of the segmentation result. In <code>lidR</code>, a <code>LAS</code> object will gain a <code>treeID</code> attribute, while for rasters, delineated crowns are returned in a <code>RasterLayer</code>. To work outside <code>segment_trees()</code> it suffices to call the function standalone like this:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" data-line-number="1">algo &lt;-<span class="st"> </span><span class="kw">dalponte2016</span>(chm_p2r_<span class="dv">05</span>_smoothed, ttops_chm_p2r_<span class="dv">05</span>_smoothed)</a>
<a class="sourceLine" id="cb78-2" data-line-number="2">crowns &lt;-<span class="st"> </span><span class="kw">algo</span>()</a>
<a class="sourceLine" id="cb78-3" data-line-number="3"></a>
<a class="sourceLine" id="cb78-4" data-line-number="4"><span class="kw">plot</span>(crowns, <span class="dt">col =</span> <span class="kw">pastel.colors</span>(<span class="dv">200</span>))</a></code></pre></div>
<p><img src="lidR-book_files/figure-html/unnamed-chunk-90-1.png" width="499.2" style="display: block; margin: auto;" /></p>
<p>The output is a <code>RasterLayer</code>, for which <code>lidR</code> does not provide any processing tools. At this stage it is up to the user to find the required tools to perform more analysis. The <code>raster</code> package is a good place to start!</p>
</div>
<div id="comparaison-of-tree-segmentations" class="section level3">
<h3><span class="header-section-number">7.2.3</span> Comparaison of tree segmentations</h3>
<p>At the point cloud level it’s pretty easy to compare tree segmentations by choosing a different attribute name for each method. For example we can compare <code>dalponte2016</code> (which is a raster based methods in two steps) and <code>li2012</code> (which is an <em>“all-in-one”</em> point cloud based method) side by side.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" data-line-number="1">algo1 &lt;-<span class="st"> </span><span class="kw">dalponte2016</span>(chm_p2r_<span class="dv">05</span>_smoothed, ttops_chm_p2r_<span class="dv">05</span>_smoothed)</a>
<a class="sourceLine" id="cb79-2" data-line-number="2">algo2 &lt;-<span class="st"> </span><span class="kw">li2012</span>()</a>
<a class="sourceLine" id="cb79-3" data-line-number="3">las &lt;-<span class="st"> </span><span class="kw">segment_trees</span>(las, algo1, <span class="dt">attribute =</span> <span class="st">&quot;IDdalponte&quot;</span>)</a>
<a class="sourceLine" id="cb79-4" data-line-number="4">las &lt;-<span class="st"> </span><span class="kw">segment_trees</span>(las, algo2, <span class="dt">attribute =</span> <span class="st">&quot;IDli&quot;</span>)</a>
<a class="sourceLine" id="cb79-5" data-line-number="5"></a>
<a class="sourceLine" id="cb79-6" data-line-number="6">x =<span class="st"> </span><span class="kw">plot</span>(las, <span class="dt">bg =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">color =</span> <span class="st">&quot;IDdalponte&quot;</span>, <span class="dt">colorPalette =</span> <span class="kw">pastel.colors</span>(<span class="dv">200</span>))</a>
<a class="sourceLine" id="cb79-7" data-line-number="7"><span class="kw">plot</span>(las, <span class="dt">add =</span> x <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">100</span>,<span class="dv">0</span>), <span class="dt">bg =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">color =</span> <span class="st">&quot;IDli&quot;</span>, <span class="dt">colorPalette =</span> <span class="kw">pastel.colors</span>(<span class="dv">200</span>))</a></code></pre></div>
<p><img src="lidR-book_files/figure-html/unnamed-chunk-92-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>By comparing their crowns with <code>delineate_crowns()</code> we can more easily see that the <code>li2012</code> algorithm doesnt perform well in this example with default parameters - maybe some parameter tuning can lead to better results!</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" data-line-number="1">crowns_dalponte &lt;-<span class="st"> </span><span class="kw">delineate_crowns</span>(las, <span class="dt">attribute =</span> <span class="st">&quot;IDdalponte&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;concave&quot;</span>)</a>
<a class="sourceLine" id="cb80-2" data-line-number="2">crowns_li &lt;-<span class="st"> </span><span class="kw">delineate_crowns</span>(las, <span class="dt">attribute =</span> <span class="st">&quot;IDli&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;concave&quot;</span>)</a>
<a class="sourceLine" id="cb80-3" data-line-number="3"></a>
<a class="sourceLine" id="cb80-4" data-line-number="4"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="dt">mar=</span><span class="kw">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>))</a>
<a class="sourceLine" id="cb80-5" data-line-number="5"><span class="kw">plot</span>(crowns_dalponte)</a>
<a class="sourceLine" id="cb80-6" data-line-number="6"><span class="kw">plot</span>(crowns_li)</a></code></pre></div>
<p><img src="lidR-book_files/figure-html/unnamed-chunk-93-1.png" width="556.8" style="display: block; margin: auto;" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chm.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="metrics.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
