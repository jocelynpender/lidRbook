<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>17 Thinking outside the box | The lidR package</title>
  <meta name="description" content="A guide to the lidR package" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="17 Thinking outside the box | The lidR package" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A guide to the lidR package" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="17 Thinking outside the box | The lidR package" />
  
  <meta name="twitter:description" content="A guide to the lidR package" />
  

<meta name="author" content="Jean-Romain Roussel, Tristan R.H. Goodbody, Piotr Tompalski" />


<meta name="date" content="2020-06-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="modelling.html"/>
<link rel="next" href="plugins.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="io.html"><a href="io.html"><i class="fa fa-check"></i><b>2</b> Reading, Plotting, Querying &amp; Validating</a><ul>
<li class="chapter" data-level="2.1" data-path="io.html"><a href="io.html#read"><i class="fa fa-check"></i><b>2.1</b> Reading LiDAR data using <code>readLAS</code></a><ul>
<li class="chapter" data-level="2.1.1" data-path="io.html"><a href="io.html#parameter-select"><i class="fa fa-check"></i><b>2.1.1</b> Parameter <code>select</code></a></li>
<li class="chapter" data-level="2.1.2" data-path="io.html"><a href="io.html#filter"><i class="fa fa-check"></i><b>2.1.2</b> Parameter <code>filter</code></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="io.html"><a href="io.html#validating-lidar-data"><i class="fa fa-check"></i><b>2.2</b> Validating lidar data</a></li>
<li class="chapter" data-level="2.3" data-path="io.html"><a href="io.html#plot"><i class="fa fa-check"></i><b>2.3</b> Plotting</a><ul>
<li class="chapter" data-level="2.3.1" data-path="io.html"><a href="io.html#basic-3d-rendering"><i class="fa fa-check"></i><b>2.3.1</b> Basic 3D rendering</a></li>
<li class="chapter" data-level="2.3.2" data-path="io.html"><a href="io.html#overlays"><i class="fa fa-check"></i><b>2.3.2</b> Overlays</a></li>
<li class="chapter" data-level="2.3.3" data-path="io.html"><a href="io.html#advanced-3d-rendering"><i class="fa fa-check"></i><b>2.3.3</b> Advanced 3D rendering</a></li>
<li class="chapter" data-level="2.3.4" data-path="io.html"><a href="io.html#crossection"><i class="fa fa-check"></i><b>2.3.4</b> Cross sections 2D rendering</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="gnd.html"><a href="gnd.html"><i class="fa fa-check"></i><b>3</b> Ground classification</a><ul>
<li class="chapter" data-level="3.1" data-path="gnd.html"><a href="gnd.html#progressive-morphological-filter"><i class="fa fa-check"></i><b>3.1</b> Progressive Morphological Filter</a></li>
<li class="chapter" data-level="3.2" data-path="gnd.html"><a href="gnd.html#cloth-simulation-function"><i class="fa fa-check"></i><b>3.2</b> Cloth Simulation Function</a></li>
<li class="chapter" data-level="3.3" data-path="gnd.html"><a href="gnd.html#buffer"><i class="fa fa-check"></i><b>3.3</b> Edge artifacts</a></li>
<li class="chapter" data-level="3.4" data-path="gnd.html"><a href="gnd.html#how-to-choose-a-method-and-its-parameters"><i class="fa fa-check"></i><b>3.4</b> How to choose a method and its parameters?</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dtm.html"><a href="dtm.html"><i class="fa fa-check"></i><b>4</b> Digital terrain model</a><ul>
<li class="chapter" data-level="4.1" data-path="dtm.html"><a href="dtm.html#triangular-irregular-network"><i class="fa fa-check"></i><b>4.1</b> Triangular irregular network</a></li>
<li class="chapter" data-level="4.2" data-path="dtm.html"><a href="dtm.html#invert-distance-weighting-idw"><i class="fa fa-check"></i><b>4.2</b> Invert distance weighting (IDW)</a></li>
<li class="chapter" data-level="4.3" data-path="dtm.html"><a href="dtm.html#kriging"><i class="fa fa-check"></i><b>4.3</b> Kriging</a></li>
<li class="chapter" data-level="4.4" data-path="dtm.html"><a href="dtm.html#pros-and-cons"><i class="fa fa-check"></i><b>4.4</b> Pros and cons</a></li>
<li class="chapter" data-level="4.5" data-path="dtm.html"><a href="dtm.html#other-methods"><i class="fa fa-check"></i><b>4.5</b> Other methods</a></li>
<li class="chapter" data-level="4.6" data-path="dtm.html"><a href="dtm.html#render-shaded-dtm"><i class="fa fa-check"></i><b>4.6</b> Render shaded DTM</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="norm.html"><a href="norm.html"><i class="fa fa-check"></i><b>5</b> Height normalization</a><ul>
<li class="chapter" data-level="5.1" data-path="norm.html"><a href="norm.html#dtm-normalization"><i class="fa fa-check"></i><b>5.1</b> DTM normalization</a></li>
<li class="chapter" data-level="5.2" data-path="norm.html"><a href="norm.html#point-cloud-normalization"><i class="fa fa-check"></i><b>5.2</b> Point cloud normalization</a></li>
<li class="chapter" data-level="5.3" data-path="norm.html"><a href="norm.html#pros-and-cons-1"><i class="fa fa-check"></i><b>5.3</b> Pros and cons</a></li>
<li class="chapter" data-level="5.4" data-path="norm.html"><a href="norm.html#reversing-normalization"><i class="fa fa-check"></i><b>5.4</b> Reversing normalization</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chm.html"><a href="chm.html"><i class="fa fa-check"></i><b>6</b> Digital Surface Model and Canopy Height model</a><ul>
<li class="chapter" data-level="6.1" data-path="chm.html"><a href="chm.html#point-to-raster"><i class="fa fa-check"></i><b>6.1</b> Point-to-raster</a></li>
<li class="chapter" data-level="6.2" data-path="chm.html"><a href="chm.html#triangulation"><i class="fa fa-check"></i><b>6.2</b> Triangulation</a></li>
<li class="chapter" data-level="6.3" data-path="chm.html"><a href="chm.html#pit-free-algorithm"><i class="fa fa-check"></i><b>6.3</b> Pit-free algorithm</a></li>
<li class="chapter" data-level="6.4" data-path="chm.html"><a href="chm.html#post-processing-a-chm"><i class="fa fa-check"></i><b>6.4</b> Post-processing a CHM</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="itd.html"><a href="itd.html"><i class="fa fa-check"></i><b>7</b> Indivitual tree dectection and segmentation</a><ul>
<li class="chapter" data-level="7.1" data-path="itd.html"><a href="itd.html#individual-tree-detection-itd"><i class="fa fa-check"></i><b>7.1</b> Individual Tree Detection (ITD)</a><ul>
<li class="chapter" data-level="7.1.1" data-path="itd.html"><a href="itd.html#local-maximum-filter-with-fixed-windows-size"><i class="fa fa-check"></i><b>7.1.1</b> Local Maximum Filter with fixed windows size</a></li>
<li class="chapter" data-level="7.1.2" data-path="itd.html"><a href="itd.html#local-maximum-filter-with-variable-windows-size"><i class="fa fa-check"></i><b>7.1.2</b> Local Maximum Filter with variable windows size</a></li>
<li class="chapter" data-level="7.1.3" data-path="itd.html"><a href="itd.html#local-maximum-filter-on-a-chm"><i class="fa fa-check"></i><b>7.1.3</b> Local Maximum Filter on a CHM</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="itd.html"><a href="itd.html#individual-tree-segmentation-its"><i class="fa fa-check"></i><b>7.2</b> Individual Tree Segmentation (ITS)</a><ul>
<li class="chapter" data-level="7.2.1" data-path="itd.html"><a href="itd.html#segmentation-of-the-point-cloud"><i class="fa fa-check"></i><b>7.2.1</b> Segmentation of the point-cloud</a></li>
<li class="chapter" data-level="7.2.2" data-path="itd.html"><a href="itd.html#segmentation-of-the-chm"><i class="fa fa-check"></i><b>7.2.2</b> Segmentation of the CHM</a></li>
<li class="chapter" data-level="7.2.3" data-path="itd.html"><a href="itd.html#comparaison-of-tree-segmentations"><i class="fa fa-check"></i><b>7.2.3</b> Comparaison of tree segmentations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="metrics.html"><a href="metrics.html"><i class="fa fa-check"></i><b>8</b> Derived metrics</a><ul>
<li class="chapter" data-level="8.1" data-path="metrics.html"><a href="metrics.html#the-basics"><i class="fa fa-check"></i><b>8.1</b> The basics</a></li>
<li class="chapter" data-level="8.2" data-path="metrics.html"><a href="metrics.html#user-defined-metrics"><i class="fa fa-check"></i><b>8.2</b> User-defined metrics</a></li>
<li class="chapter" data-level="8.3" data-path="metrics.html"><a href="metrics.html#pre-defined-metrics"><i class="fa fa-check"></i><b>8.3</b> Pre-defined metrics</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="cba.html"><a href="cba.html"><i class="fa fa-check"></i><b>9</b> Derived metrics at the cloud level</a><ul>
<li class="chapter" data-level="9.1" data-path="cba.html"><a href="cba.html#overview"><i class="fa fa-check"></i><b>9.1</b> Overview</a></li>
<li class="chapter" data-level="9.2" data-path="cba.html"><a href="cba.html#applications"><i class="fa fa-check"></i><b>9.2</b> Applications</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="aba.html"><a href="aba.html"><i class="fa fa-check"></i><b>10</b> Derived metrics at the grid level</a><ul>
<li class="chapter" data-level="10.1" data-path="aba.html"><a href="aba.html#overview-1"><i class="fa fa-check"></i><b>10.1</b> Overview</a></li>
<li class="chapter" data-level="10.2" data-path="aba.html"><a href="aba.html#applications-1"><i class="fa fa-check"></i><b>10.2</b> Applications</a><ul>
<li class="chapter" data-level="10.2.1" data-path="aba.html"><a href="aba.html#modelling"><i class="fa fa-check"></i><b>10.2.1</b> Modelling</a></li>
<li class="chapter" data-level="10.2.2" data-path="aba.html"><a href="aba.html#density"><i class="fa fa-check"></i><b>10.2.2</b> Density</a></li>
<li class="chapter" data-level="10.2.3" data-path="aba.html"><a href="aba.html#intensity"><i class="fa fa-check"></i><b>10.2.3</b> Intensity</a></li>
<li class="chapter" data-level="10.2.4" data-path="aba.html"><a href="aba.html#other"><i class="fa fa-check"></i><b>10.2.4</b> Other</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="tba.html"><a href="tba.html"><i class="fa fa-check"></i><b>11</b> Derived metrics at the tree level</a><ul>
<li class="chapter" data-level="11.1" data-path="tba.html"><a href="tba.html#overview-2"><i class="fa fa-check"></i><b>11.1</b> Overview</a></li>
<li class="chapter" data-level="11.2" data-path="tba.html"><a href="tba.html#applications-2"><i class="fa fa-check"></i><b>11.2</b> Applications</a><ul>
<li class="chapter" data-level="11.2.1" data-path="tba.html"><a href="tba.html#selection-of-trees"><i class="fa fa-check"></i><b>11.2.1</b> Selection of trees</a></li>
<li class="chapter" data-level="11.2.2" data-path="tba.html"><a href="tba.html#tree-based-inventory"><i class="fa fa-check"></i><b>11.2.2</b> Tree based inventory</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="vba.html"><a href="vba.html"><i class="fa fa-check"></i><b>12</b> Derived metrics at the voxel level</a><ul>
<li class="chapter" data-level="12.1" data-path="vba.html"><a href="vba.html#overview-3"><i class="fa fa-check"></i><b>12.1</b> Overview</a></li>
<li class="chapter" data-level="12.2" data-path="vba.html"><a href="vba.html#applications-3"><i class="fa fa-check"></i><b>12.2</b> Applications</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="pba.html"><a href="pba.html"><i class="fa fa-check"></i><b>13</b> Derived metrics at point level</a><ul>
<li class="chapter" data-level="13.1" data-path="pba.html"><a href="pba.html#overview-4"><i class="fa fa-check"></i><b>13.1</b> Overview</a></li>
<li class="chapter" data-level="13.2" data-path="pba.html"><a href="pba.html#applications-4"><i class="fa fa-check"></i><b>13.2</b> Applications</a><ul>
<li class="chapter" data-level="13.2.1" data-path="pba.html"><a href="pba.html#roof-segmentation"><i class="fa fa-check"></i><b>13.2.1</b> Roof segmentation</a></li>
<li class="chapter" data-level="13.2.2" data-path="pba.html"><a href="pba.html#lake-and-wire-segmentation"><i class="fa fa-check"></i><b>13.2.2</b> Lake and wire segmentation</a></li>
<li class="chapter" data-level="13.2.3" data-path="pba.html"><a href="pba.html#sec:pba-mscoloring"><i class="fa fa-check"></i><b>13.2.3</b> Multi-spectral coloring</a></li>
<li class="chapter" data-level="13.2.4" data-path="pba.html"><a href="pba.html#outlier-filtering"><i class="fa fa-check"></i><b>13.2.4</b> Outlier filtering</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="engine.html"><a href="engine.html"><i class="fa fa-check"></i><b>14</b> <code>LAScatalog</code> processing engine (1/2)</a><ul>
<li class="chapter" data-level="14.1" data-path="engine.html"><a href="engine.html#rationale-for-lascatalog-functionality"><i class="fa fa-check"></i><b>14.1</b> Rationale for <code>LAScatalog</code> functionality</a></li>
<li class="chapter" data-level="14.2" data-path="engine.html"><a href="engine.html#the-lascatalog-engine"><i class="fa fa-check"></i><b>14.2</b> The <code>LAScatalog</code> engine</a></li>
<li class="chapter" data-level="14.3" data-path="engine.html"><a href="engine.html#files"><i class="fa fa-check"></i><b>14.3</b> Read a collection of files</a></li>
<li class="chapter" data-level="14.4" data-path="engine.html"><a href="engine.html#validation"><i class="fa fa-check"></i><b>14.4</b> Validation</a></li>
<li class="chapter" data-level="14.5" data-path="engine.html"><a href="engine.html#extract-regions-of-interest"><i class="fa fa-check"></i><b>14.5</b> Extract Regions of interest</a><ul>
<li class="chapter" data-level="14.5.1" data-path="engine.html"><a href="engine.html#extract-a-single-roi"><i class="fa fa-check"></i><b>14.5.1</b> Extract a single ROI</a></li>
<li class="chapter" data-level="14.5.2" data-path="engine.html"><a href="engine.html#multiple-extractions"><i class="fa fa-check"></i><b>14.5.2</b> Multiple extractions</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="engine.html"><a href="engine.html#modification-of-default-behavior"><i class="fa fa-check"></i><b>14.6</b> Modification of default behavior</a><ul>
<li class="chapter" data-level="14.6.1" data-path="engine.html"><a href="engine.html#multiple-extractions-on-disk"><i class="fa fa-check"></i><b>14.6.1</b> Multiple extractions on disk</a></li>
<li class="chapter" data-level="14.6.2" data-path="engine.html"><a href="engine.html#multiple-extraction-with-point-cloud-indexation"><i class="fa fa-check"></i><b>14.6.2</b> Multiple extraction with point cloud indexation</a></li>
</ul></li>
<li class="chapter" data-level="14.7" data-path="engine.html"><a href="engine.html#summary"><i class="fa fa-check"></i><b>14.7</b> Summary</a></li>
<li class="chapter" data-level="14.8" data-path="engine.html"><a href="engine.html#ground-classification"><i class="fa fa-check"></i><b>14.8</b> Ground classification</a><ul>
<li class="chapter" data-level="14.8.1" data-path="engine.html"><a href="engine.html#chunk-processing"><i class="fa fa-check"></i><b>14.8.1</b> Chunk processing</a></li>
<li class="chapter" data-level="14.8.2" data-path="engine.html"><a href="engine.html#modifying-buffers"><i class="fa fa-check"></i><b>14.8.2</b> Modifying buffers</a></li>
<li class="chapter" data-level="14.8.3" data-path="engine.html"><a href="engine.html#modify-the-chunk-size"><i class="fa fa-check"></i><b>14.8.3</b> Modify the chunk size</a></li>
<li class="chapter" data-level="14.8.4" data-path="engine.html"><a href="engine.html#parallel-processing"><i class="fa fa-check"></i><b>14.8.4</b> Parallel processing</a></li>
</ul></li>
<li class="chapter" data-level="14.9" data-path="engine.html"><a href="engine.html#summary-1"><i class="fa fa-check"></i><b>14.9</b> Summary</a></li>
<li class="chapter" data-level="14.10" data-path="engine.html"><a href="engine.html#digital-terrain-model"><i class="fa fa-check"></i><b>14.10</b> Digital Terrain Model</a><ul>
<li class="chapter" data-level="14.10.1" data-path="engine.html"><a href="engine.html#in-memory-dtm"><i class="fa fa-check"></i><b>14.10.1</b> In memory DTM</a></li>
<li class="chapter" data-level="14.10.2" data-path="engine.html"><a href="engine.html#on-disk-dtm"><i class="fa fa-check"></i><b>14.10.2</b> On disk DTM</a></li>
</ul></li>
<li class="chapter" data-level="14.11" data-path="engine.html"><a href="engine.html#storage-summary"><i class="fa fa-check"></i><b>14.11</b> Storage Summary</a></li>
<li class="chapter" data-level="14.12" data-path="engine.html"><a href="engine.html#height-normalization"><i class="fa fa-check"></i><b>14.12</b> Height normalization</a></li>
<li class="chapter" data-level="14.13" data-path="engine.html"><a href="engine.html#area-based-approach"><i class="fa fa-check"></i><b>14.13</b> Area Based Approach</a></li>
<li class="chapter" data-level="14.14" data-path="engine.html"><a href="engine.html#height-aba-summary"><i class="fa fa-check"></i><b>14.14</b> Height &amp; ABA Summary</a></li>
<li class="chapter" data-level="14.15" data-path="engine.html"><a href="engine.html#individual-tree-detection"><i class="fa fa-check"></i><b>14.15</b> Individual Tree Detection</a><ul>
<li class="chapter" data-level="14.15.1" data-path="engine.html"><a href="engine.html#itd-summary"><i class="fa fa-check"></i><b>14.15.1</b> ITD Summary</a></li>
</ul></li>
<li class="chapter" data-level="14.16" data-path="engine.html"><a href="engine.html#individual-tree-segmentation"><i class="fa fa-check"></i><b>14.16</b> Individual Tree Segmentation</a></li>
<li class="chapter" data-level="14.17" data-path="engine.html"><a href="engine.html#retile-a-catalog"><i class="fa fa-check"></i><b>14.17</b> Retile a catalog</a><ul>
<li class="chapter" data-level="14.17.1" data-path="engine.html"><a href="engine.html#retile-a-catalog-into-smaller-files"><i class="fa fa-check"></i><b>14.17.1</b> Retile a catalog into smaller files</a></li>
<li class="chapter" data-level="14.17.2" data-path="engine.html"><a href="engine.html#add-a-buffer-around-each-file"><i class="fa fa-check"></i><b>14.17.2</b> Add a buffer around each file</a></li>
<li class="chapter" data-level="14.17.3" data-path="engine.html"><a href="engine.html#create-a-new-collection-with-only-first-returns"><i class="fa fa-check"></i><b>14.17.3</b> Create a new collection with only first returns</a></li>
<li class="chapter" data-level="14.17.4" data-path="engine.html"><a href="engine.html#create-a-new-collection-of-small-and-buffered-ground-returns-in-parallel"><i class="fa fa-check"></i><b>14.17.4</b> Create a new collection of small and buffered ground returns in parallel</a></li>
</ul></li>
<li class="chapter" data-level="14.18" data-path="engine.html"><a href="engine.html#the-case-of-ground-inventories"><i class="fa fa-check"></i><b>14.18</b> The case of ground inventories</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="engine2.html"><a href="engine2.html"><i class="fa fa-check"></i><b>15</b> LAScatalog processing engine (2/2)</a><ul>
<li class="chapter" data-level="15.1" data-path="engine2.html"><a href="engine2.html#catalog_apply"><i class="fa fa-check"></i><b>15.1</b> <code>catalog_apply()</code></a></li>
<li class="chapter" data-level="15.2" data-path="engine2.html"><a href="engine2.html#create-user-defined-function"><i class="fa fa-check"></i><b>15.2</b> Create user-defined function</a></li>
<li class="chapter" data-level="15.3" data-path="engine2.html"><a href="engine2.html#create-an-intermediate-function-for-catalog_apply"><i class="fa fa-check"></i><b>15.3</b> Create an intermediate function for <code>catalog_apply()</code></a></li>
<li class="chapter" data-level="15.4" data-path="engine2.html"><a href="engine2.html#make-a-user-friendly-function-for-third-party-users"><i class="fa fa-check"></i><b>15.4</b> Make a user-friendly function for third party users</a></li>
<li class="chapter" data-level="15.5" data-path="engine2.html"><a href="engine2.html#make-a-safe-function-for-third-party-users"><i class="fa fa-check"></i><b>15.5</b> Make a safe function for third party users</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="aba.html"><a href="aba.html#modelling"><i class="fa fa-check"></i><b>16</b> The Area-Based Approach (ABA) to forest modelling</a><ul>
<li class="chapter" data-level="16.1" data-path="modelling.html"><a href="modelling.html"><i class="fa fa-check"></i><b>16.1</b> Read in data</a></li>
<li class="chapter" data-level="16.2" data-path="modelling.html"><a href="modelling.html#aba-processing"><i class="fa fa-check"></i><b>16.2</b> ABA Processing</a><ul>
<li class="chapter" data-level="16.2.1" data-path="modelling.html"><a href="modelling.html#step-1---clip-als-ground-inventory"><i class="fa fa-check"></i><b>16.2.1</b> Step 1 - Clip ALS ground inventory</a></li>
<li class="chapter" data-level="16.2.2" data-path="modelling.html"><a href="modelling.html#step-2---calculate-plot-metrics"><i class="fa fa-check"></i><b>16.2.2</b> Step 2 - Calculate plot metrics</a></li>
<li class="chapter" data-level="16.2.3" data-path="modelling.html"><a href="modelling.html#step-3---modeling"><i class="fa fa-check"></i><b>16.2.3</b> Step 3 - Modeling</a></li>
<li class="chapter" data-level="16.2.4" data-path="modelling.html"><a href="modelling.html#step-4---wall-to-wall-modelling"><i class="fa fa-check"></i><b>16.2.4</b> Step 4 - Wall to wall modelling</a></li>
<li class="chapter" data-level="16.2.5" data-path="modelling.html"><a href="modelling.html#step-5---calculate-wall-to-wall-predictions"><i class="fa fa-check"></i><b>16.2.5</b> Step 5 - Calculate wall-to-wall predictions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="outbox.html"><a href="outbox.html"><i class="fa fa-check"></i><b>17</b> Thinking outside the box</a><ul>
<li class="chapter" data-level="17.1" data-path="outbox.html"><a href="outbox.html#new-complex-metrics-in-aba"><i class="fa fa-check"></i><b>17.1</b> New complex metrics in ABA</a><ul>
<li class="chapter" data-level="17.1.1" data-path="outbox.html"><a href="outbox.html#outboxdistancereturn"><i class="fa fa-check"></i><b>17.1.1</b> Distance between returns</a></li>
<li class="chapter" data-level="17.1.2" data-path="outbox.html"><a href="outbox.html#outboxrumple"><i class="fa fa-check"></i><b>17.1.2</b> Rumple index</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="outbox.html"><a href="outbox.html#multi-spectral-coloring"><i class="fa fa-check"></i><b>17.2</b> Multi-spectral coloring</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="plugins.html"><a href="plugins.html"><i class="fa fa-check"></i><b>18</b> <code>lidR</code> plugin system</a><ul>
<li class="chapter" data-level="18.1" data-path="plugins.html"><a href="plugins.html#understanding-lidr-algorithms"><i class="fa fa-check"></i><b>18.1</b> Understanding lidR algorithms</a></li>
<li class="chapter" data-level="18.2" data-path="plugins.html"><a href="plugins.html#creation-of-the-mba-algorithm"><i class="fa fa-check"></i><b>18.2</b> Creation of the <code>mba</code> algorithm</a></li>
<li class="chapter" data-level="18.3" data-path="plugins.html"><a href="plugins.html#what-about-other-algorithms"><i class="fa fa-check"></i><b>18.3</b> What about other algorithms?</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The <code>lidR</code> package</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="outbox" class="section level1">
<h1><span class="header-section-number">17</span> Thinking outside the box</h1>
<p>We have presented many common processes through these tutorials. Most examples presented could have been done with other softwares, but what we have seen is only the tip of the <code>lidR</code> iceberg! In fact, <code>lidR</code> was never designed with common processes in mind, but instead to explore new ones and push innovation in this field. Some examples might be found here and there in the book. The following chapter presents some applications that are likely to be impossible to reproduce in other softwares, demonstrating how we can go from a novel idea to a fully functional tool using <code>lidR</code>.</p>
<div id="new-complex-metrics-in-aba" class="section level2">
<h2><span class="header-section-number">17.1</span> New complex metrics in ABA</h2>
<div id="outboxdistancereturn" class="section level3">
<h3><span class="header-section-number">17.1.1</span> Distance between returns</h3>
<p>In forestry, simple metrics can be derived from first returns. But what about metrics that estimate the average distance between first and last returns? Is is a valuable metric for characterizing of forest stucture? Can we refine the prediction? Nobody knows, but we can try.</p>
<p>First, we need to retrieve each emitted pulse and keep only the first and last point of each sequence excluding sequences with only one return.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb196-1" data-line-number="1">las &lt;-<span class="st"> </span><span class="kw">retrieve_pulses</span>(las)</a>
<a class="sourceLine" id="cb196-2" data-line-number="2">las &lt;-<span class="st"> </span><span class="kw">filter_firstlast</span>(las)</a>
<a class="sourceLine" id="cb196-3" data-line-number="3">las &lt;-<span class="st"> </span><span class="kw">filter_poi</span>(las, NumberOfReturns <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<p>Using the <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html"><code>data.table</code> syntax</a> we can compute the distance between first and last returns for each pulse. It could be done with <code>dplyr</code> as well using <code>group_by() %&gt;%  mutate()</code> but we are proponent of using <code>data.table()</code>.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb197-1" data-line-number="1">las<span class="op">@</span>data[, d <span class="op">:</span><span class="er">=</span><span class="st"> </span>Z[<span class="dv">1</span>]<span class="op">-</span>Z[<span class="dv">2</span>], by =<span class="st"> </span>pulseID]</a></code></pre></div>
<p>At this stage our data set contains distances twice. <strong>1</strong> associated with the first return and <strong>2</strong> with the last return. We only need a single value, so lets keep only first returns. Some distances are <code>NA</code> and correspond to pulses at the very edge of the file. We can discard those case for the moment.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb198-1" data-line-number="1">las &lt;-<span class="st"> </span><span class="kw">filter_first</span>(las)</a>
<a class="sourceLine" id="cb198-2" data-line-number="2">las &lt;-<span class="st"> </span><span class="kw">filter_poi</span>(las, <span class="op">!</span><span class="kw">is.na</span>(d))</a></code></pre></div>
<p>We can now plot the first returns colored by their distance to the last return.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb199-1" data-line-number="1"><span class="kw">plot</span>(las, <span class="dt">bg =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;d&quot;</span>, <span class="dt">colorPalette =</span> viridis<span class="op">::</span><span class="kw">magma</span>(<span class="dv">50</span>), <span class="dt">size =</span> <span class="dv">4</span>)</a></code></pre></div>
<p><img src="lidR-book_files/figure-html/unnamed-chunk-194-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Now we can compute the average in an ABA (see section <a href="aba.html#aba">10</a>).</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb200-1" data-line-number="1">d_first_last =<span class="st"> </span><span class="kw">grid_metrics</span>(las, <span class="op">~</span><span class="kw">mean</span>(d), <span class="dv">15</span>)</a>
<a class="sourceLine" id="cb200-2" data-line-number="2"><span class="kw">plot</span>(d_first_last, <span class="dt">col =</span> <span class="kw">height.colors</span>(<span class="dv">50</span>))</a></code></pre></div>
<p><img src="lidR-book_files/figure-html/unnamed-chunk-195-1.png" width="518.4" style="display: block; margin: auto;" /></p>
<p>Now we have a working method, we can extend the idea to apply it over a broad coverage using the <code>LAScatalog</code> processing engine – see section <a href="engine.html#engine">14</a>. First we create a function that does this job. This is not mandatory but factorizing the code is good practice.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb201-1" data-line-number="1">grid_distance_first_last =<span class="st"> </span><span class="cf">function</span>(las, res) {</a>
<a class="sourceLine" id="cb201-2" data-line-number="2">  las &lt;-<span class="st"> </span><span class="kw">retrieve_pulses</span>(las)</a>
<a class="sourceLine" id="cb201-3" data-line-number="3">  las &lt;-<span class="st"> </span><span class="kw">filter_firstlast</span>(las)</a>
<a class="sourceLine" id="cb201-4" data-line-number="4">  las &lt;-<span class="st"> </span><span class="kw">filter_poi</span>(las, NumberOfReturns <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb201-5" data-line-number="5">  las<span class="op">@</span>data[, d <span class="op">:</span><span class="er">=</span><span class="st"> </span>Z[<span class="dv">1</span>]<span class="op">-</span>Z[<span class="dv">2</span>], by =<span class="st"> </span>pulseID][]</a>
<a class="sourceLine" id="cb201-6" data-line-number="6">  las &lt;-<span class="st"> </span><span class="kw">filter_first</span>(las)</a>
<a class="sourceLine" id="cb201-7" data-line-number="7">  las &lt;-<span class="st"> </span><span class="kw">filter_poi</span>(las, <span class="op">!</span><span class="kw">is.na</span>(d))</a>
<a class="sourceLine" id="cb201-8" data-line-number="8">  <span class="kw">return</span>(<span class="kw">grid_metrics</span>(las, <span class="op">~</span><span class="kw">mean</span>(d), res))</a>
<a class="sourceLine" id="cb201-9" data-line-number="9">}</a></code></pre></div>
<p>Then we define a function that respects some requirement imposed by the <code>LAScatalog</code> processing engine.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb202-1" data-line-number="1">my_routine &lt;-<span class="st"> </span><span class="cf">function</span>(chunk, res) {</a>
<a class="sourceLine" id="cb202-2" data-line-number="2">  bbox &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw">extent</span>(chunk)</a>
<a class="sourceLine" id="cb202-3" data-line-number="3">  las &lt;-<span class="st"> </span><span class="kw">readLAS</span>(chunk)</a>
<a class="sourceLine" id="cb202-4" data-line-number="4">  <span class="cf">if</span> (<span class="kw">is.empty</span>(las)) <span class="kw">return</span>(<span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb202-5" data-line-number="5">  metric &lt;-<span class="st"> </span><span class="kw">grid_distance_first_last</span>(las, res)</a>
<a class="sourceLine" id="cb202-6" data-line-number="6">  metric &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw">crop</span>(metric, bbox)</a>
<a class="sourceLine" id="cb202-7" data-line-number="7">  <span class="kw">return</span>(metric)</a>
<a class="sourceLine" id="cb202-8" data-line-number="8">}</a></code></pre></div>
<p>To finish we use the <code>LAScatalog</code> processing engine with <code>catalog_sapply()</code>. We need to process with a buffer to avoid the case where pulses are separated in two files, so we use <code>opt_chunk_buffer(ctg) &lt;- 2</code>. In addition, with the output being a raster, we ensure alignment of the chunk with the raster.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb203-1" data-line-number="1">ctg &lt;-<span class="st"> </span><span class="kw">readLAScatalog</span>(<span class="st">&quot;folder/&quot;</span>)</a>
<a class="sourceLine" id="cb203-2" data-line-number="2"><span class="kw">opt_chunk_buffer</span>(ctg) &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb203-3" data-line-number="3">options &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">raster_alignment =</span> <span class="dv">15</span>)</a>
<a class="sourceLine" id="cb203-4" data-line-number="4">metrics &lt;-<span class="st"> </span><span class="kw">catalog_sapply</span>(ctg, my_routine, <span class="dt">res =</span> <span class="dv">15</span>, <span class="dt">.options =</span> options)</a></code></pre></div>
<p>And we are done. Our innovative metric is computing with real-time monitoring. It can run in parallel on a single machine or in parallel on several machines. At the end, the output is a wall-to-wall raster map of the average distance between first and last returns for beams that return multiple returns. In 19 lines of code!</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb204-1" data-line-number="1"><span class="kw">plot</span>(metrics, <span class="dt">col =</span> <span class="kw">height.colors</span>(<span class="dv">50</span>))</a></code></pre></div>
<p><img src="lidR-book_files/figure-html/displaymap-1.png" width="595.2" style="display: block; margin: auto;" /></p>
</div>
<div id="outboxrumple" class="section level3">
<h3><span class="header-section-number">17.1.2</span> Rumple index</h3>
<p>Another interesting metric that could be computed is the rumple index (see <a href="https://gis.ess.washington.edu/keck/ESS_421_additional_reading/Kane_Interpretation_and_topographic.pdf">Kane et al. (2008)</a>).</p>
<p>To compute a rumple index we can triangulate points, measure the surface created, and divide by the projected surface. Rumple index is however expected to measure surface roughness of the canopy and it doesn’t makes sense to triangulate every point. An option is to triangulate each first return but yet first returns are not all representative of the canopy. In the following example we are using the surface points every 1 m.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb205-1" data-line-number="1">grid_rumple_index =<span class="st"> </span><span class="cf">function</span>(las, res) { <span class="co"># user-defined function</span></a>
<a class="sourceLine" id="cb205-2" data-line-number="2">  las &lt;-<span class="st"> </span><span class="kw">filter_surfacepoints</span>(las, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb205-3" data-line-number="3">  <span class="kw">return</span>(<span class="kw">grid_metrics</span>(las, <span class="op">~</span><span class="kw">rumple_index</span>(X, Y, Z), res))</a>
<a class="sourceLine" id="cb205-4" data-line-number="4">}</a></code></pre></div>
<p>Then the code is pretty much the same than in previous section</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb206-1" data-line-number="1">my_routine &lt;-<span class="st"> </span><span class="cf">function</span>(chunk, res) {</a>
<a class="sourceLine" id="cb206-2" data-line-number="2">  bbox &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw">extent</span>(chunk)</a>
<a class="sourceLine" id="cb206-3" data-line-number="3">  las &lt;-<span class="st"> </span><span class="kw">readLAS</span>(chunk)</a>
<a class="sourceLine" id="cb206-4" data-line-number="4">  <span class="cf">if</span> (<span class="kw">is.empty</span>(las)) <span class="kw">return</span>(<span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb206-5" data-line-number="5">  metric &lt;-<span class="st"> </span><span class="kw">grid_rumple_index</span>(las, res)</a>
<a class="sourceLine" id="cb206-6" data-line-number="6">  metric &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw">crop</span>(metric, bbox)</a>
<a class="sourceLine" id="cb206-7" data-line-number="7">  <span class="kw">return</span>(metric)</a>
<a class="sourceLine" id="cb206-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb206-9" data-line-number="9"></a>
<a class="sourceLine" id="cb206-10" data-line-number="10">ctg &lt;-<span class="st"> </span><span class="kw">readLAScatalog</span>(<span class="st">&quot;folder/&quot;</span>)</a>
<a class="sourceLine" id="cb206-11" data-line-number="11"><span class="kw">opt_chunk_buffer</span>(ctg) &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb206-12" data-line-number="12">options &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">raster_alignment =</span> <span class="dv">20</span>)</a>
<a class="sourceLine" id="cb206-13" data-line-number="13">metrics &lt;-<span class="st"> </span><span class="kw">catalog_sapply</span>(ctg, my_routine, <span class="dt">res =</span> <span class="dv">20</span>, <span class="dt">.options =</span> options)</a>
<a class="sourceLine" id="cb206-14" data-line-number="14"><span class="kw">plot</span>(metrics, <span class="dt">col =</span> <span class="kw">height.colors</span>(<span class="dv">50</span>))</a></code></pre></div>
<p><img src="lidR-book_files/figure-html/displaymap2-1.png" width="595.2" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="multi-spectral-coloring" class="section level2">
<h2><span class="header-section-number">17.2</span> Multi-spectral coloring</h2>
<p>We have already seen a multi-spectral coloring example in section <a href="pba.html#sec:pba-mscoloring">13.2.3</a>. This is truly a good example of how to think outside the box with <code>lidR</code>, so we show several variants here. The goal is to use multi-spectral data to generate false coloring and see how false coloring may be used for further analyses.</p>
<p>Multi-spectral ALS data are sampled with 3 devices each emitting a different wavelength. The point cloud is usually provided in the form of 3 <code>LAS</code> files, each file corresponding to a spectral wavelength. No matter the actual wavelength, we can consider the first band as blue, the second as red, and the third as green, and thus consider that each point has a pure color.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb207-1" data-line-number="1">f1 =<span class="st"> &quot;data/chap11/PR1107_c1_ar_c.laz&quot;</span></a>
<a class="sourceLine" id="cb207-2" data-line-number="2">f2 =<span class="st"> &quot;data/chap11/PR1107_c2_ar_c.laz&quot;</span></a>
<a class="sourceLine" id="cb207-3" data-line-number="3">f3 =<span class="st"> &quot;data/chap11/PR1107_c3_ar_c.laz&quot;</span></a>
<a class="sourceLine" id="cb207-4" data-line-number="4">las &lt;-<span class="st"> </span><span class="kw">readMSLAS</span>(f1, f2, f3,  <span class="dt">filter =</span> <span class="st">&quot;-keep_z_below 300&quot;</span>)</a>
<a class="sourceLine" id="cb207-5" data-line-number="5"><span class="kw">plot</span>(las, <span class="dt">color =</span> <span class="st">&quot;ScannerChannel&quot;</span>, <span class="dt">size =</span> <span class="dv">6</span>)</a></code></pre></div>
<p><img src="lidR-book_files/figure-html/unnamed-chunk-199-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Each channels returns vary in intensities as seen in the figure below because of the wavelength reflectance properties of the targets. A first step could be to normalize the intensities. For this example we won’t do that to keep things simple.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb208-1" data-line-number="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb208-2" data-line-number="2"><span class="kw">ggplot</span>(las<span class="op">@</span>data) <span class="op">+</span></a>
<a class="sourceLine" id="cb208-3" data-line-number="3"><span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> Intensity, <span class="dt">fill =</span> <span class="kw">as.factor</span>(ScannerChannel)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb208-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb208-5" data-line-number="5"><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb208-6" data-line-number="6"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(.<span class="dv">9</span>, <span class="fl">.90</span>),</a>
<a class="sourceLine" id="cb208-7" data-line-number="7">        <span class="dt">legend.title =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="lidR-book_files/figure-html/unnamed-chunk-200-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>In this specific example, notice that only few intensities are above 255, So intensity ranges from 0 to almost 255. This is very convenient because we will be able to use the raw values as color without transformation. We will simply force values above 255 to be 255. This is a dirty solution but fair enough for the example which is not about intensity normalization.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb209-1" data-line-number="1">las<span class="op">@</span>data[Intensity <span class="op">&gt;</span><span class="st"> </span>255L, Intensity <span class="op">:</span><span class="er">=</span><span class="st"> </span>255L]</a></code></pre></div>
<p>To finish, we define a function that takes the intensities and the associated channel as inputs. This function decomposes the 3 channels, computes the average intensity of each channel, and returns these 3 values that will later be interpreted as RGB. Also if one color can is missing we force RGB to be NA.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb210-1" data-line-number="1">colorize &lt;-<span class="st"> </span><span class="cf">function</span>(intensity, channel)</a>
<a class="sourceLine" id="cb210-2" data-line-number="2">{</a>
<a class="sourceLine" id="cb210-3" data-line-number="3">  <span class="co"># Split the intensities of each channel</span></a>
<a class="sourceLine" id="cb210-4" data-line-number="4">  i1 =<span class="st"> </span>intensity[channel <span class="op">==</span><span class="st"> </span>1L]</a>
<a class="sourceLine" id="cb210-5" data-line-number="5">  i2 =<span class="st"> </span>intensity[channel <span class="op">==</span><span class="st"> </span>2L]</a>
<a class="sourceLine" id="cb210-6" data-line-number="6">  i3 =<span class="st"> </span>intensity[channel <span class="op">==</span><span class="st"> </span>3L]</a>
<a class="sourceLine" id="cb210-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb210-8" data-line-number="8">  <span class="co"># If one channel is missing return RGB = NA</span></a>
<a class="sourceLine" id="cb210-9" data-line-number="9">  <span class="cf">if</span> (<span class="kw">length</span>(i1) <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span><span class="kw">length</span>(i2) <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span><span class="kw">length</span>(i3) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb210-10" data-line-number="10">    <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">R =</span> <span class="ot">NA_integer_</span>, <span class="dt">G =</span> <span class="ot">NA_integer_</span>, <span class="dt">B =</span> <span class="ot">NA_integer_</span>))</a>
<a class="sourceLine" id="cb210-11" data-line-number="11">  </a>
<a class="sourceLine" id="cb210-12" data-line-number="12">  i1 =<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">mean</span>(i1))</a>
<a class="sourceLine" id="cb210-13" data-line-number="13">  i2 =<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">mean</span>(i2))</a>
<a class="sourceLine" id="cb210-14" data-line-number="14">  i3 =<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">mean</span>(i3))</a>
<a class="sourceLine" id="cb210-15" data-line-number="15">  </a>
<a class="sourceLine" id="cb210-16" data-line-number="16">  <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">R =</span> i1, <span class="dt">G =</span> i2, <span class="dt">B =</span> i3))</a>
<a class="sourceLine" id="cb210-17" data-line-number="17">}</a></code></pre></div>
<p>Now we can use this function with different levels of regularization. We can use <code>colorize()</code> with <code>grid_metrics()</code> in an ABA. It returns a multi-layer raster that can be interpreted as RGB</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb211-1" data-line-number="1">rgb =<span class="st"> </span><span class="kw">grid_metrics</span>(las, <span class="op">~</span><span class="kw">colorize</span>(Intensity, ScannerChannel), <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb211-2" data-line-number="2"><span class="kw">plotRGB</span>(rgb, <span class="dt">axes =</span> T)</a></code></pre></div>
<p><img src="lidR-book_files/figure-html/unnamed-chunk-203-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>We can also attribute an RGB color per voxel, discarding the voxels where <code>RGB = NA</code> by using <code>colorize()</code> with <code>voxel_metrics()</code> (see chapter <a href="vba.html#vba">12</a>).</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb212-1" data-line-number="1">rgb &lt;-<span class="st"> </span><span class="kw">voxel_metrics</span>(las, <span class="op">~</span><span class="kw">colorize</span>(Intensity, ScannerChannel), <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb212-2" data-line-number="2">rgb &lt;-<span class="st"> </span>rgb[<span class="op">!</span><span class="kw">is.na</span>(R)] <span class="co"># Remove NAs</span></a>
<a class="sourceLine" id="cb212-3" data-line-number="3">rgb &lt;-<span class="st"> </span><span class="kw">LAS</span>(rgb, las<span class="op">@</span>header) <span class="co"># Convert to LAS for display</span></a>
<a class="sourceLine" id="cb212-4" data-line-number="4"><span class="kw">plot</span>(rgb, <span class="dt">color =</span> <span class="st">&quot;RGB&quot;</span>, <span class="dt">nbits =</span> <span class="dv">8</span>, <span class="dt">size =</span> <span class="dv">5</span>)</a></code></pre></div>
<p><img src="lidR-book_files/figure-html/unnamed-chunk-204-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>To finish we can <code>colorize()</code> with <code>point_metrics()</code> (see chapter <a href="pba.html#pba">13</a>). This has the advantage of maintaining much more points compared to the voxel-based version and to preserve coordinates.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb213-1" data-line-number="1">rgb =<span class="st"> </span><span class="kw">point_metrics</span>(las, <span class="op">~</span><span class="kw">colorize</span>(Intensity, ScannerChannel), <span class="dt">r =</span> <span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb213-2" data-line-number="2">las &lt;-<span class="st"> </span><span class="kw">add_lasrgb</span>(las, rgb<span class="op">$</span>R, rgb<span class="op">$</span>G, rgb<span class="op">$</span>B)</a>
<a class="sourceLine" id="cb213-3" data-line-number="3">colored &lt;-<span class="st"> </span><span class="kw">filter_poi</span>(las, <span class="op">!</span><span class="kw">is.na</span>(R)) <span class="co"># Remove NAs</span></a>
<a class="sourceLine" id="cb213-4" data-line-number="4"><span class="kw">plot</span>(colored, <span class="dt">color =</span> <span class="st">&quot;RGB&quot;</span>, <span class="dt">size =</span> <span class="dv">4</span>)</a></code></pre></div>
<p><img src="lidR-book_files/figure-html/unnamed-chunk-205-1.png" width="672" style="display: block; margin: auto;" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="modelling.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="plugins.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
